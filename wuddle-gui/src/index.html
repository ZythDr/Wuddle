<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wuddle</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>

  <body>
    <header class="topbar">
      <div class="title">
        <div class="appname">Wuddle</div>
        <div class="subtitle">Apparently a launcher now?</div>
      </div>

      <div class="tabs view-tabs-center" role="group" aria-label="Project view">
        <button id="tabHome" class="btn view-btn" type="button">Home</button>
        <button id="btnViewMods" class="btn view-btn active" type="button">Mods</button>
        <button id="btnViewAddons" class="btn view-btn" type="button">Addons</button>
      </div>

      <div class="actions">
        <div id="busyIndicator" class="busy-indicator hidden" title="Working" aria-label="Working"></div>
        <div class="tabs top-tabs">
          <div id="profilePickerHost" class="profile-picker-host"></div>
          <div class="tabs-divider" aria-hidden="true"></div>
          <button id="tabOptions" class="tab-btn tab-icon-btn" title="Options" aria-label="Options">
            <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0 0 0 .12-.64l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.28 7.28 0 0 0-1.63-.94l-.36-2.54a.5.5 0 0 0-.49-.42h-3.84a.5.5 0 0 0-.49.42l-.36 2.54c-.58.22-1.13.53-1.63.94l-2.39-.96a.5.5 0 0 0-.6.22L2.7 8.84a.5.5 0 0 0 .12.64l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94L2.82 14.5a.5.5 0 0 0-.12.64l1.92 3.32a.5.5 0 0 0 .6.22l2.39-.96c.5.41 1.05.72 1.63.94l.36 2.54a.5.5 0 0 0 .49.42h3.84a.5.5 0 0 0 .49-.42l.36-2.54c.58-.22 1.13-.53 1.63-.94l2.39.96a.5.5 0 0 0 .6-.22l1.92-3.32a.5.5 0 0 0-.12-.64l-2.03-1.56ZM12 15.5A3.5 3.5 0 1 1 12 8.5a3.5 3.5 0 0 1 0 7Z"
              />
            </svg>
            <span class="sr-only">Options</span>
          </button>
          <button id="tabLogs" class="tab-btn tab-icon-btn" title="Logs" aria-label="Logs">
            <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M5 4.5A1.5 1.5 0 0 1 6.5 3h9l4.5 4.5V19.5A1.5 1.5 0 0 1 18.5 21h-12A1.5 1.5 0 0 1 5 19.5v-15Zm10 .5v3h3"
              />
              <path d="M8 11h8M8 14h8M8 17h6" />
            </svg>
            <span class="sr-only">Logs</span>
          </button>
          <button id="tabAbout" class="tab-btn tab-icon-btn" title="About" aria-label="About">
            <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="12" cy="12" r="9" />
              <path d="M12 10v6" />
              <path d="M12 7h.01" />
            </svg>
            <span class="sr-only">About</span>
          </button>
        </div>
      </div>
    </header>

    <section id="panelHome" class="card panel hidden">
      <div class="home-grid">
        <section class="settings-card home-card home-card-main">
          <div class="row space-between align-center home-head">
            <div class="settings-head">Updates</div>
            <div class="row tight align-center home-head-actions">
              <details id="homeAddMenu" class="home-add-menu">
                <summary id="homeBtnAddMenu" class="btn">Add new</summary>
                <div class="home-add-menu-pop">
                  <button id="homeBtnAddMod" class="menu-item" type="button">Add mod</button>
                  <button id="homeBtnAddAddon" class="menu-item" type="button">Add addon</button>
                </div>
              </details>
              <span class="home-action-sep" aria-hidden="true"></span>
              <button id="homeBtnRefreshOnly" class="btn">Check for updates</button>
              <button id="homeBtnUpdateAll" class="btn">Update All (0)</button>
            </div>
          </div>

          <div class="home-updates-columns">
            <div class="home-update-col">
              <div class="home-update-col-head">
                <span>Mods</span>
                <span id="homeModsUpdateCount" class="home-update-col-count">0</span>
              </div>
              <div id="homeModList" class="home-update-lines">
                <div class="home-update-empty">No mod updates.</div>
              </div>
            </div>
            <div class="home-update-col">
              <div class="home-update-col-head">
                <span>Addons</span>
                <span id="homeAddonsUpdateCount" class="home-update-col-count">0</span>
              </div>
              <div id="homeAddonList" class="home-update-lines">
                <div class="home-update-empty">No addon updates.</div>
              </div>
            </div>
          </div>

        </section>
      </div>

      <div class="project-footer home-footer">
        <div class="row align-center footer-tools">
          <div id="homeLaunchStatus" class="hint">Launch target: VanillaFixes.exe if installed, otherwise Wow.exe.</div>
          <div class="row tight align-center footer-actions">
            <button id="homeBtnPlay" class="btn home-play-btn" type="button">PLAY</button>
          </div>
        </div>
      </div>
    </section>

    <section id="panelProjects" class="card panel projects-panel">
      <div class="projects-toolbar">
        <div class="filter-status-row">
          <div class="filter-group" id="filterGroup" role="group" aria-label="Project filters">
            <button class="btn filter-btn active" data-filter="all">All (0)</button>
            <button class="btn filter-btn" data-filter="updates">Updates (0)</button>
            <button class="btn filter-btn" data-filter="errors">Errors (0)</button>
            <button class="btn filter-btn" data-filter="disabled">Disabled (0)</button>
          </div>
          <span id="statApiState" class="stat-pill muted">API status: unknown</span>
        </div>
        <button id="btnAddOpen" class="btn">＋ Add New Mod</button>
      </div>

      <div class="table table-scroll">
        <div id="repoThead" class="thead">
          <div id="thName" class="th sortable active" data-sort="name" data-dir="asc">Name</div>
          <div id="thCurrent" class="th sortable" data-sort="current">Current</div>
          <div id="thLatest" class="th sortable" data-sort="latest">Latest</div>
          <div id="thEnabled">Enabled</div>
          <div id="thStatus" class="th sortable" data-sort="status">Status</div>
          <div id="thActions">Actions</div>
        </div>

        <div id="repoRows" class="tbody">
          <div class="empty">No repos yet. Click “＋ Add”.</div>
        </div>
      </div>

      <div class="project-footer">
        <div class="row align-center footer-tools">
          <div class="row tight align-center footer-actions">
            <div id="lastChecked" class="hint">Last checked: never</div>
            <button id="btnRetryFailed" class="btn">Retry Failed</button>
            <button id="btnUpdateAll" class="btn">Check for updates</button>
          </div>
        </div>
      </div>
    </section>

    <section id="panelOptions" class="card panel hidden">
      <div class="options-grid">
        <section class="settings-card">
          <div class="settings-head">Instances</div>
          <div class="hint">Each instance has its own tracked mod/addon list. Click a card to edit details.</div>
          <div id="instanceList" class="instance-list options-block"></div>
          <div class="row tight options-block">
            <button id="btnAddInstance" class="btn">+ Add Instance</button>
          </div>
        </section>

        <section class="settings-card">
          <div class="settings-head">Behavior</div>
          <div class="row options-block checks">
            <label class="check">
              <input id="optSymlinks" type="checkbox" />
              <span>Use symlink installs when possible</span>
            </label>
            <label class="check">
              <input id="optXattr" type="checkbox" />
              <span>Set xattr file comments (if OS supports it)</span>
            </label>
          </div>
        </section>

        <section class="settings-card">
          <div class="settings-head">Time and display</div>
          <div class="row options-block checks">
            <label class="check">
              <input id="optClock12" type="checkbox" />
              <span>Use 12-hour time format (AM/PM)</span>
            </label>
          </div>
        </section>

        <section class="settings-card auth-block">
          <div class="row align-center auth-header-row">
            <div class="settings-head">GitHub Authentication</div>
            <div id="ghAuthHint" class="hint">
              Optional: add a GitHub token to avoid anonymous API rate limits.
            </div>
          </div>

          <div class="row tight auth-connect-row">
            <button
              id="btnConnectGithub"
              class="btn"
              title="Opens GitHub in your browser so you can create or manage a token."
            >
              GitHub Tokens
            </button>
          </div>

          <div class="hint auth-recommended">Recommended: create a classic token with no scopes/permissions selected, and set a custom expiration of 1 year.</div>
          
          <div class="row align-end auth-row">
            <label class="field grow">
              GitHub token (stored in system keychain):
              <input
                id="githubToken"
                type="password"
                placeholder="ghp_..."
                autocomplete="off"
                spellcheck="false"
            />
            </label>
            <button id="btnSaveGithubToken" class="btn primary">Save token</button>
            <button id="btnClearGithubToken" class="btn danger">Forget</button>
          </div>

          <div class="auth-status-row">
            <span id="ghAuthBadge" class="auth-badge">No token</span>
            <div id="ghAuthStatus" class="hint"></div>
          </div>
          <div id="ghAuthHealth" class="auth-health hidden"></div>
        </section>
      </div>
    </section>

    <section id="panelLogs" class="card panel hidden">
      <div class="row space-between align-center">
        <div>
          <div class="section-title">Logs</div>
          <div class="hint">Action and error messages.</div>
        </div>
        <div class="row tight">
          <button id="btnClearLog" class="btn" type="button">Clear</button>
          <button id="btnCopyLog" class="btn" type="button">Copy Log</button>
        </div>
      </div>

      <div class="row space-between align-center projects-tools">
        <div class="filter-group" id="logLevelGroup" role="group" aria-label="Log level filters">
          <button id="btnLogLevelAll" class="btn filter-btn active" data-log-level="all">All</button>
          <button id="btnLogLevelInfo" class="btn filter-btn" data-log-level="info">Info</button>
          <button id="btnLogLevelError" class="btn filter-btn" data-log-level="error">Errors</button>
        </div>
        <div class="row tight align-center">
          <label class="check">
            <input id="optLogWrap" type="checkbox" />
            <span>Wrap lines</span>
          </label>
          <label class="check">
            <input id="optLogAutoscroll" type="checkbox" checked />
            <span>Auto-scroll</span>
          </label>
          <label class="field log-search">
            <input id="logSearch" placeholder="Search logs" />
          </label>
        </div>
      </div>

      <pre id="log" class="log log-panel"></pre>
    </section>

    <section id="panelAbout" class="card panel hidden">
      <div class="row space-between align-center">
        <div>
          <div class="section-title">About</div>
          <div class="hint">Basic application metadata.</div>
        </div>
        <div class="row tight">
          <button id="btnAboutRefresh" class="btn" type="button">Refresh details</button>
          <button id="btnAboutGithub" class="btn" type="button">Open Wuddle on GitHub</button>
        </div>
      </div>

      <div class="about-grid">
        <section class="settings-card">
          <div class="settings-head">Application</div>
          <div class="about-list">
            <div class="about-row">
              <div class="about-key">Current version:</div>
              <div id="aboutAppVersion" class="about-value about-mono">—</div>
            </div>
            <div class="about-row">
              <div class="about-key">Latest version:</div>
              <button id="aboutLatestVersion" class="about-value about-mono about-link-btn" type="button">—</button>
            </div>
            <div class="about-row">
              <div class="about-key">Package name</div>
              <div id="aboutPackageName" class="about-value about-mono">—</div>
            </div>
          </div>
        </section>
      </div>

      <div id="aboutStatus" class="hint about-status">Loading application details…</div>
    </section>

    <!-- Add modal -->
    <dialog id="dlgAdd" class="dialog">
      <form method="dialog" class="dialog-inner">
        <div class="dialog-head">
          <div>
            <div id="addDialogTitle" class="dialog-title">Add a repo</div>
            <div id="addDialogHint" class="hint">Quick-add from the mods listed, or add your own Git repo URL below.</div>
          </div>
          <button id="btnAddCloseX" class="btn ghost icon" value="cancel" aria-label="Close">✕</button>
        </div>

        <div id="quickAddField" class="field">
          <div class="label">Quick add (click to expand)</div>
          <div id="addPresetList" class="preset-list"></div>
        </div>

        <label class="field">
          <div id="addRepoUrlLabel" class="label">Repo URL</div>
          <input id="repoUrl" placeholder="(e.g. https://gitea.com/avitasia/nampower)" />
        </label>

        <details class="advanced">
          <summary>Advanced</summary>
          <label class="field">
            <div class="label">Mode override (optional)</div>
            <select id="mode">
              <option value="auto" selected>auto (recommended)</option>
              <option value="addon">addon</option>
              <option value="addon_git">addon_git (clone/pull)</option>
              <option value="dll">dll</option>
              <option value="mixed">mixed</option>
              <option value="raw">raw</option>
            </select>
          </label>
        </details>

        <div class="dialog-actions">
          <button class="btn ghost" value="cancel">Cancel</button>
          <button id="btnAdd" class="btn primary" value="ok">Add</button>
        </div>
      </form>
    </dialog>

    <!-- SuperWoW risk warning modal -->
    <dialog id="dlgSuperwowRisk" class="dialog">
      <form method="dialog" class="dialog-inner">
        <div class="dialog-head">
          <div>
            <div class="dialog-title">SuperWoW Anti-Virus Warning!</div>
            <div class="hint">
              SuperWoW is known to false-flag as malware in most antivirus software.
            </div>
          </div>
          <button class="btn ghost icon" value="cancel" aria-label="Close">✕</button>
        </div>

        <div class="field">
          <div class="hint risk-note">
            Installing SuperWoW will almost certainly trigger your anti-virus software, and it will likely seem like
            <code>Wuddle.exe</code> is responsible (since Wuddle is what downloads and installs it). This happens
            because SuperWoW itself is known to trigger false-positives in many anti-virus products.
          </div>
          <div class="hint risk-note">
            For this reason, you have three options:
          </div>
          <ol class="risk-list">
            <li>
              Temporarily disable your anti-virus and add your WoW directory to AV exclusions
              (Follow step 1 &amp; 2 in
              <button id="superwowGuideLink" class="inline-link" type="button">Pepopo978's guide</button>), so
              <code>SuperWoWhook.dll</code> is not removed after install.
            </li>
            <li>
              Allow the false-positive threat for Wuddle/SuperWoW so you do not need to disable AV for future SuperWoW updates.
            </li>
            <li>Do not install SuperWoW.</li>
          </ol>
        </div>

        <div class="dialog-actions">
          <button class="btn ghost" value="cancel">Cancel</button>
          <button class="btn warn" value="ok">Continue</button>
        </div>
      </form>
    </dialog>

    <!-- Remove modal -->
    <dialog id="dlgRemove" class="dialog">
      <form method="dialog" class="dialog-inner">
        <div class="dialog-head">
          <div>
            <div class="dialog-title">Remove Project</div>
            <div class="hint">Choose whether to remove only from Wuddle, or also delete local installed files.</div>
          </div>
          <button class="btn ghost icon" value="cancel" aria-label="Close">✕</button>
        </div>

        <div class="field">
          <div class="label">Project</div>
          <div id="removeRepoName" class="hint"></div>
        </div>

        <label class="check remove-check">
          <input id="removeLocalFiles" type="checkbox" />
          <span>Remove local files</span>
        </label>

        <div class="dialog-actions">
          <button class="btn ghost" value="cancel">Cancel</button>
          <button id="btnRemoveConfirm" class="btn danger" value="ok">Remove</button>
        </div>
      </form>
    </dialog>

    <!-- Remove instance modal -->
    <dialog id="dlgRemoveInstance" class="dialog">
      <form method="dialog" class="dialog-inner">
        <div class="dialog-head">
          <div>
            <div class="dialog-title">Remove Instance</div>
            <div class="hint">This removes the instance from Wuddle.</div>
          </div>
          <button class="btn ghost icon" value="cancel" aria-label="Close">✕</button>
        </div>

        <div class="field">
          <div class="label">Instance</div>
          <div id="removeInstanceName" class="hint"></div>
        </div>

        <label class="check remove-check">
          <input id="removeInstanceLocalFiles" type="checkbox" />
          <span>Remove installed mods from this instance</span>
        </label>

        <div class="dialog-actions">
          <button class="btn ghost" value="cancel">Cancel</button>
          <button id="btnRemoveInstanceConfirm" class="btn danger" value="ok">Remove</button>
        </div>
      </form>
    </dialog>

    <!-- Instance settings modal -->
    <dialog id="dlgInstanceSettings" class="dialog">
      <form method="dialog" class="dialog-inner">
        <div class="dialog-head">
          <div>
            <div class="dialog-title">Instance Settings</div>
            <div class="hint">Configure name, game executable path, and launch behavior for this instance.</div>
          </div>
          <button class="btn ghost icon" value="cancel" aria-label="Close">✕</button>
        </div>

        <input id="instanceSettingsId" type="hidden" />

        <label class="field">
          <div class="label">Name</div>
          <input id="instanceSettingsName" placeholder="WoW1" />
        </label>

        <div class="row align-end instance-path-row">
          <label class="field grow instance-path-field">
            <div class="label">WoW path</div>
            <input id="instanceSettingsPath" placeholder="/path/to/Wow.exe (or VanillaFixes.exe)" />
          </label>
          <button id="btnInstanceSettingsChoosePath" class="btn" type="button">Choose...</button>
          <button id="btnInstanceSettingsOpenPath" class="btn" type="button">Open</button>
        </div>

        <label class="field">
          <div class="label">Launch method</div>
          <select id="instanceSettingsLaunchMethod">
            <option value="auto">Auto (VanillaFixes.exe / Wow.exe)</option>
            <option value="lutris">Lutris</option>
            <option value="wine">Wine</option>
            <option value="custom">Custom command</option>
          </select>
        </label>

        <div id="instanceSettingsLaunchAuto" class="instance-launch-group hint">
          Wuddle launches <code>VanillaFixes.exe</code> if present, otherwise <code>Wow.exe</code>.
        </div>

        <div id="instanceSettingsLaunchLutris" class="instance-launch-group hidden">
          <label class="field">
            <div class="label">Lutris target</div>
            <input
              id="instanceSettingsLutrisTarget"
              placeholder="lutris:rungameid/2"
            />
          </label>
          <div class="hint">Example: <code>lutris:rungameid/2</code></div>
        </div>

        <div id="instanceSettingsLaunchWine" class="instance-launch-group hidden">
          <label class="field">
            <div class="label">Wine command</div>
            <input id="instanceSettingsWineCommand" placeholder="wine" />
          </label>
          <label class="field">
            <div class="label">Extra args (optional)</div>
            <input id="instanceSettingsWineArgs" placeholder="--some-arg value" />
          </label>
        </div>

        <div id="instanceSettingsLaunchCustom" class="instance-launch-group hidden">
          <label class="field">
            <div class="label">Custom command</div>
            <input id="instanceSettingsCustomCommand" placeholder="command" />
          </label>
          <label class="field">
            <div class="label">Arguments (optional)</div>
            <input
              id="instanceSettingsCustomArgs"
              placeholder="--flag value"
            />
          </label>
          <div class="hint">Tip: use <code>{exe}</code> in args to inject the detected game executable path.</div>
        </div>

        <label class="field">
          <div class="label">Working directory override (optional)</div>
          <input id="instanceSettingsWorkingDir" placeholder="/path/to/working/dir" />
        </label>

        <label class="field">
          <div class="label">Environment variables (optional)</div>
          <textarea
            id="instanceSettingsEnv"
            rows="4"
            placeholder="KEY=VALUE"
          ></textarea>
        </label>

        <div class="dialog-actions">
          <button id="btnInstanceSettingsCancel" class="btn ghost" value="cancel">Cancel</button>
          <button id="btnInstanceSettingsSave" class="btn primary" value="ok">Save</button>
        </div>
      </form>
    </dialog>

    <script type="module" src="./main.js"></script>
  </body>
</html>
